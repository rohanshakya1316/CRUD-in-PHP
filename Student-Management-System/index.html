<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Management System</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;700&family=Poppins:wght@200;300;400;600&family=Quicksand:wght@300;400;500;600;700&family=Urbanist:wght@300;400;600;700;800;900&display=swap"
      rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h2>Student Management System</h2>
    <form id="studentForm">
      <input type="hidden" id="studentId" />
      <input type="text" id="studentName" placeholder="Name" required />
      <input type="email" id="studentEmail" placeholder="Email" required />
      <input type="text" id="studentCourse" placeholder="Course" required />
      <button type="submit" id="submitBtn">Add Student</button>
    </form>

    <h3>Student List</h3>
    <table id="studentList">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Course</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Students will be fetched here dynamically through AJAX -->
      </tbody>
    </table>

    <script>
      $(document).ready(function () {
        // Load Students
        function loadStudents() {
          $.ajax({
            url: "read_students.php",
            method: "GET",
            dataType: "json",
            success: function (data) {
              let students = data;
              let studentRows = "";
              students.forEach(function (student) {
                studentRows += `<tr>
                            <td>${student.id}</td>
                            <td>${student.name}</td>
                            <td>${student.email}</td>
                            <td>${student.course}</td>
                            <td>
                                <button class="editBtn" data-id="${student.id}" data-name="${student.name}" data-email="${student.email}" data-course="${student.course}">Edit</button>
                                <button class="deleteBtn" data-id="${student.id}">Delete</button>
                            </td>
                        </tr>`;
              });
              $("#studentList tbody").html(studentRows);
            },
          });
        }

        loadStudents();

        // Add/Update Student
        $("#studentForm").submit(function (e) {
          e.preventDefault();

          let studentId = $("#studentId").val();
          let name = $("#studentName").val();
          let email = $("#studentEmail").val();
          let course = $("#studentCourse").val();

          let url = studentId ? "update_student.php" : "create_student.php";
          let method = studentId ? "POST" : "POST";

          $.ajax({
            url: url,
            method: method,
            data: { id: studentId, name: name, email: email, course: course },
            success: function (response) {
              alert(response);
              loadStudents();
              $("#studentForm")[0].reset();
              $("#studentId").val("");
              $("#submitBtn").text("Add Student");
            },
          });
        });

        // Edit Student
        $(document).on("click", ".editBtn", function () {
          let studentId = $(this).data("id");
          let studentName = $(this).data("name");
          let studentEmail = $(this).data("email");
          let studentCourse = $(this).data("course");

          $("#studentId").val(studentId);
          $("#studentName").val(studentName);
          $("#studentEmail").val(studentEmail);
          $("#studentCourse").val(studentCourse);
          $("#submitBtn").text("Update Student");
        });

        // Delete Student
        $(document).on("click", ".deleteBtn", function () {
          let studentId = $(this).data("id");

          if (confirm("Are you sure you want to delete this student?")) {
            $.ajax({
              url: "delete_student.php",
              method: "POST",
              data: { id: studentId },
              success: function (response) {
                alert(response);
                loadStudents();
              },
            });
          }
        });
      });
    </script>
  </body>
</html>
